document.write('<title>XIII Days To Save The Kingdom</title><body><style>body{background:#333;margin:0;font-family:monospace;color:#fff}button{color:#fff;background:#333;min-width:100px}</style><div id=cdv></div>');let t=(t,e,i)=>({t:new Ce(t),i:new Ce(e),o:0,h:i,active:!1}),h=t=>{t.active=!0,t.o=0,t.t.start(),t.i.start()},L=t=>{t.active=!1},a=(t,e)=>{t.active&&(t.t.update(e),t.i.update(e),t.t.l()&&(t.o=(t.o+1)%(t.h+1),t.t.start()),t.i.l())&&L(t)};class E{controls=[];u;v(){return this.u}p(t){this.controls.push(t)}update(t){var e=this.u;e&&(e.t.update(t),e.t.l())&&(e.commit(),this.controls.shift(),this.u=void 0),this.controls.length&&(t=this.controls[0],this.u||((this.u=t).init(),t.t.start()))}}let d=(t=100,e=()=>{},i=()=>{})=>({init:e,commit:i,t:new Ce(t)}),l=(t,e)=>{let i=t.g(n,e)-5,s=t.g(u,e),r=Math.floor(t.g(v,e)/50),a=(1+D(i+s+r+1,1,10,0,100)/100).toFixed(2),o=a.split(".")[1];for(;o.length<2;)a+="0",o=a.split(".")[1];return a},R=t=>{var e,i=P(0),s=t[0];i.m.scale=8;for(e of[n,u,v,f,c,o])i[e]=s[e];return i.k=s.k,i.m.M=s.m.M,i.label=s.label,i};class H{_;S;C;T;N=new E;O;Y="";A=!1;D;I;$=t=>{};B=0;L=0;constructor(t,e,i,s){this._=i,this.S=s,this.C=R(t),this.C.m.M="ts_4",this.C.label="Hero's Army",this.T=R(e),this.T.m.R=!0,this.T.m.H="r";i=this.j(this.C);this.B=this.C.g(c,i),this.L=this.T.g(c,{})}F(t,e,i){var{width:t,height:s}=(this.O=t).canvas,t=(this.C.P(t/2-96-64,s/2-64),this.T.P(t/2+96-64,s/2-64),S("div")),s=(Object.assign(t.style,{height:"100px",overflowY:"scroll",overflowX:"hidden",background:"#333",color:"white"}),C(i,t),this.I=t,S("p")),t=(Object.assign(s.style,{textAlign:"right"}),T("button","OK"));t.onclick=()=>{e?.remove(),this.$(this.Y)},t.style.visibility="hidden",this.D=t,C(s,t),C(i,s)}K(t,e){return{U:t,G:e}}j(t){return{X:this.V(t)}}q(...t){this.I&&(t=(t.join(" ")+"<br>").replace(/\s/g,"&nbsp;"),t=T("span",t),C(this.I,t),this.I.scrollTop=this.I.scrollHeight)}W(t){return t===this.C?"left":"right"}V(t){return t===this.C?this._:this.S}J(t,e){var i=this.K(t,e),s=e.g(u,{...i,X:this.V(e)}),i=Math.max(1,t.g(n,{...i,X:this.V(t)})-s),s=Math.max(1,i-Math.floor(i*t[o]));return{Z:s,tt:i,et:this.st(e,s*t.k).it,rt:this.st(e,i*t.k).it}}st(t,e){let i=t[f]+(t.k-1)*t[v],s=(i-e)%t[v],r=(0===s&&(s=t[v]),Math.ceil((i-e)/t[v]));return r<=0&&(r=0),{ot:s,it:r}}ht(t,e){let i=!1;this.K(t,e).X=this.V(e);var{Z:s,tt:r,et:a,rt:o}=this.J(t,e),h=Math.round(Math.max(1,D(B(),0,1,s,r)))*t.k,{it:n,ot:l}=this.st(e,h),d=e.k-n;n<=0&&(i=!0),this.q(t.label,"attacks",e.label,"for",h,"damage, defeating",d,"units."),this.q(" --\x3e",`min damage was ${s*t.k} (defeating ${e.k-a})`),this.q(" --\x3e",`max damage was ${r*t.k} (defeating ${e.k-o})`),e[f]=l,e.k=n,i}nt(){return!!this.Y||(0===this.C.k?(this.Y="lose",this.C.visible=!1,this.D?.style.setProperty("visibility","visible"),zt(this.D),I("lose"),!0):0===this.T.k?(this.Y="win",this.T.visible=!1,this.D?.style.setProperty("visibility","visible"),zt(this.D),I("battle_win"),!0):void 0)}lt(){if(!this.nt()&&!this.N.u){let r=this.B>=this.L?[this.C,this.T]:[this.T,this.C],a=0,o=()=>{if(!(a>=r.length)){let t=r[a],e="left"===this.W(t),i=e?this.C:this.T,s=e?this.T:this.C;a++,this.N.p(d(300,()=>{h(i.ut.dt)},()=>{this.ht(t,s),I("attack"),0===s.k&&(I("flicker_enemy"),h(s.ut.ft)),L(i.ut.dt)})),this.N.p(d(300,()=>{},()=>{0===s.k&&(L(s.ut.ft),s.vt=!0),this.nt()||o()}))}};o()}}start(){this.A=!0}update(t){this.C.update(t),this.T.update(t),this.N.update(t),!this.N.u&&this.A&&this.lt()}ct(){var e=this.O;if(e){b(0,0,e.canvas.width,e.canvas.height,"#555",!1,e);var i=Math.ceil((e.canvas.width+19)/19);for(let t=0;t<i**2;t++)b(t%i*19-19,19*Math.floor(t/i),19,19,`rgba(52,221,5,${D(Math.abs(Math.sin(19*t*3)),0,1,.3,.5)})`,!1,e);this.C.ct(this.O,this.A?"":this.B),this.T.ct(this.O,this.A?"":this.L),this.A||(t=this.B>=this.L?this.C:this.T,s=this.B>=this.L?"lightgreen":"red",x(t.label+" will go first!",e.canvas.width/2,e.canvas.height-50,{size:22,color:s},e));var t=this.j(this.C),s=l(this.C,t),t=l(this.T,{});this.Y||(x("Troop Rating: "+s,12,12,{size:14,align:"left",strokeColor:""},e),x("Troop Rating: "+t,e.canvas.width-12,12,{size:14,align:"right",strokeColor:""},e)),"win"===this.Y&&x("Victory!",e.canvas.width/2,30,{size:28},e),"lose"===this.Y&&x("Defeat...",e.canvas.width/2,30,{size:28},e)}}}let n="att",u="def",f="hp",v="mhp",c="spd",o="avp",j=()=>({gt:t(50,100,1),dt:t(75,225,1),ft:t(100,300,1)}),F=(t,e)=>{var i=P(t.wt);return i.k=e,Object.assign(i,t),i.bt="ts_"+t.xt,i.m.M=i.bt,i},P=(t=p)=>{let e=ye(),i={yt:t,label:"Footman",k:0,bt:"ts_20",kt:[0,0],X:void 0,Mt:"player",visible:!0,vt:!1,_t:void 0,ut:j(),N:new E,m:e},s=(i[n]=1,i[u]=1,i[f]=1,i[v]=1,i[c]=1,i[o]=0,e.M=i.bt,{P(t,e){r.kt=[t,e],r.m.x=t,r.m.y=e},getBounds:()=>[r.m.x,r.m.y,64,64],g:(t,e)=>{e=e.X?.[t]??0,t=Number(r[t]);return Math.max(0,t+e+0)},update:t=>{var e;r.N.update(t),a(r.ut.dt,t),r.ut.dt.active?(e=r.m.R?-1:1,r.m.offsetX=(r.ut.dt.o?0:-4)*e):r.m.offsetX=0,a(r.ut.ft,t),r.ut.ft.active?r.visible=!!r.ut.ft.o:r.visible=!0},ct:(t,e)=>{r.visible&&!r.vt&&(ke(r.m,t),x(""+r.k,r.m.x+(r.m.H?8:16*r.m.scale-8),r.m.y,{size:28},t),e)&&x("Speed: "+e,r.m.x+16*r.m.scale/2,r.m.y+16*r.m.scale,{size:16},t)}}),r={...i,...s};return r},e=new Map,K=new Map,s=new Map,U=t=>5*Math.ceil(t/5),G=0,X=1,V=2,q=3,W=4,J=5,Q=6,Z=7,tt=8,et=11,it=12,st=13,rt=14,p=0,at=1,ot=2,ht=3,nt=4,lt=5,dt=6,ut=7,ft=8,vt=9,ct=10,pt=11,g=12,gt=13,wt=async()=>{yt(),xt(),At(),Yt(),$t(),Ct();var t=[qt([["ts","ts.png",16,16]]),kt()];await Promise.all(t)},mt=t=>s.get(t-1)??100,bt=t=>e.get(t),w=t=>i.get(t),M=t=>Tt.get(t),_=t=>r.get(t),xt=()=>{var e=[0,1,2,3,8,9,10,11,16,17,18,19,24],i=[1,100,2,100,.5,1,1,1,1,1,1,100,1];for(let t=0;t<e.length;t++)s.set(e[t],i[t])},yt=()=>{e.set("item",[,,397,.02,.05,.18,1,2.3,,-23,465,.06,.06,,,,,.56,.02]),e.set("lose",[1.3,,31,,.19,.004,3,4,,,-329,.33,,,35,,.37,,.4,.03]),e.set("exp",[1.4,0,667,.03,.31,.41,,2.1,.4,-.3,125,.05,.08,,,,.09,.98,,.08]),e.set("horse_step",[1.2,,750,.01,,.008,3,1.4,15,,,,,,62,,.06,.53]),e.set("attack",[1.4,,101,.02,.06,.05,4,2.8,,,,,.09,1.8,,.4,.05,.74,.09,.49,1660]),e.set("flicker_enemy",[2.3,,456,,,.28,,1.7,4,,,,.07,1.7,,.1,.15,.66,.04,.44]),e.set("gold",[,,975,.03,.01,.008,1,4.9,,,290,.03,.02,,,,,.74,.32]),e.set("gain_level",[,,44,.09,,.01,3,3.3,,8,,.11,,,9.7,,,.97,.43]),e.set("battle_win",[2,,9,.28,.09,.06,,3.3,,-77,73,.24,,,,,.38,.54,.01,,-1333]),e.set("blip",[,,1008,,.01,.01,4,2,,-25,,,,.1,,.6,,.69,.02]),e.set("fight",[,,737,,.01,0,1,.3,,49,247,.03,,.5,184,,,.8,.02,.05]),e.set("ready_to_fight",[1.9,,330,.32,.36,.29,,2.7,,,46,,,,53,,.35,.91,.03]),e.set("visit_village",[1.1,,640,.02,.03,.01,2,1.2,-4,,-225,.09,.06,,26,,.19,.52,.03,.05,725]),e.set("new_turn",[2.8,,100,.07,.01,.23,1,3.2,,,,,,,,,.18,.67,.28,.41,105])},kt=async()=>{var t,e=[],i=new Map;for(t of we.data){var s,r,a,o=Number(t);isNaN(o)?([s,r]=t.split(",").map(t=>+t),e.push(s),(a={0:G,9:X,10:V,11:q,16:W,17:J,18:Q,24:Z})[8]=a[0],a[19]=a[11],i.set(e.length-1,[a[s-1],r])):e.push(o)}K.set("map",{width:we.width,height:we.height,data:e,St:i})},r=new Map,Mt=[],_t=[],St=t=>{var e=Array.from(r.keys());for(t.length=0,e.shift();e.length;){var i=Math.floor(B()*e.length),i=e.splice(i,1)[0];t.push(i)}},Ct=()=>{var e=(...[t,e,i,s])=>{r.set(r.size,{name:t,Ct:e,Tt:i,Nt:s})};e("Crown of Light",0,0);for(let t=0;t<2;t++)e("Bronze Sword",75,15,{[n]:1}),e("Iron Sword",100,25,{[n]:2}),e("Steel Sword",150,50,{[n]:3}),e("Sturdy Boots",70,15,{[c]:1}),e("Swift Boots",90,25,{[c]:2}),e("Magic Boots",140,50,{[c]:3}),e("Light Shield",75,15,{[u]:1}),e("Medium Shield",100,25,{[u]:2}),e("Heavy Shield",150,50,{[u]:3}),e("Power Pendant",125,75,{[n]:1,[c]:1}),e("Defense Charm",125,75,{[c]:1,[u]:1}),e("Yin Yang",125,75,{[n]:1,[u]:1}),e("Omni Flower",500,100,{[n]:2,[c]:2,[u]:2});St(_t),e("Small Supply Stash",0,50),e("Big Supply Stash",0,100),St(Mt)},Tt=new Map,Nt=[],Ot=[],Yt=()=>{var e=(...[t,e,i,s])=>{Nt.push([t,e,i,s])};for(let t=0;t<4;t++)e(1,p,10+15*t,75+35*t);for(let t=0;t<5;t++)e(2,p,50+15*t,100+45*t);for(let t=0;t<4;t++)e(3,p,100+25*t,100+55*t);var i=(...[t,...e])=>{Ot.push([t,e])},s=(t,e)=>U(D(B(),0,1,t,e));for(let t=0;t<4;t++)i(1,[dt,s(35,65)]),i(1,[p,s(35,65)]),i(1,[ht,s(35,65)]),i(1,[ct,s(35,65)]),i(2,[ct,s(100,200)]),i(2,[gt,s(50,100)]),i(2,[g,s(40,60)]),i(2,[ut,s(50,100)]),i(2,[at,s(75,125)]),i(2,[nt,s(75,125)]),i(3,[pt,s(25,40)]),i(3,[g,s(50,100)]),i(3,[gt,s(100,200)]),i(2,[at,s(150,200)]),i(3,[ft,s(50,100)]),i(3,[ot,s(75,125)]),i(3,[lt,s(75,125)]);i(4,[vt,300]),i(4,[g,200]),i(4,[pt,100]),Nt=Be(Nt),Ot=Be(Ot)},At=()=>{var t=(t,e,i,s)=>{e={wt:t,label:e,xt:i,[n]:5,[o]:.5,[u]:0,[f]:10,[v]:10},i=Object.assign({...e},s);i[v]=i[f],Tt.set(t,i)},e=n,i=c,s=u,r=f;t(p,"Militia",20,{}),t(at,"Footmen",21,{[e]:7,[s]:5,[r]:25}),t(ot,"Champions",22,{[e]:12,[s]:10,[r]:50}),t(ht,"Archers",28,{[i]:5,[r]:8}),t(nt,"Crossbows",29,{[e]:6,[i]:10,[r]:8}),t(lt,"Arbalists",30,{[e]:12,[i]:15}),t(dt,"Scouts",12,{[i]:3,[s]:1,[r]:20}),t(ut,"Knights",13,{[e]:8,[i]:7,[s]:2,[r]:40}),t(ft,"Cavaliers",14,{[e]:12,[i]:10,[s]:12,[r]:60}),t(vt,"Mages",36,{[i]:16,[e]:15,[s]:4,[r]:75}),t(ct,"Goblins",31,{[e]:4,[s]:1,[r]:6}),t(pt,"Beasts",15,{[e]:12,[s]:6,[r]:350,[i]:5}),t(g,"Skulls",37,{[e]:20,[s]:3,[r]:25,[i]:20}),t(gt,"Longnecks",23,{[e]:10,[i]:4,[s]:5,[r]:55})},i=new Map,Dt=(t,e)=>{t=t.map.Ot[e];t.event=void 0,t.id=1,t.bt="ts_0"},It=t=>Object.entries(t).map(([t,e])=>t.toUpperCase()+": "+e).join(" "),$t=()=>{let s=(e,i)=>{let s;for(let t=0;t<e.length;t++){var r=e[t];if(i===r[0]){s=[...r.slice(1)],e.splice(t,1);break}}return s},n="info",r=(i.set(G,(t,e,i)=>({label:"Battle",Yt:"ready_to_fight",At:{Dt:i,units:s(Ot,e)[0]}})),i.set(X,(t,e,i)=>{let s=U(D(B(),0,1,20*e,100*e));return{label:"Chest",Yt:"gold",It:{type:n,title:"Chest",M:"ts_9",text:`You found ${s} <b>GOLD</b>!`,$t:()=>{Dt(t,i),t.Bt.zt+=s}}}}),i.set(V,(t,e,i)=>{let s=Mt.shift(),r=_(s),a="";return r.Nt&&(a=It(r.Nt)),{label:"Present",Yt:"item",It:{type:n,title:"Present",M:"ts_10",text:`You found: ${r.name}!  `+a,$t:()=>{Dt(t,i),t.Bt.Lt(s)}}}}),i.set(q,(t,e,i)=>({label:"Castle",Yt:"battle_win",It:{...r,text:"You made it!  You brought us the <b>Crown of Light</b> and the Kingdom is saved!",$t:()=>{window.location.reload()}}})),i.set(W,(t,e,i)=>({label:"Village",Yt:"visit_village",store:{text:"You found a village! Need to buy or sell items?",items:[_t.shift(),_t.shift()],M:"ts_16"}})),i.set(J,(t,e,i)=>({label:"Tower",Yt:"visit_village",store:{text:"The Tower can provide you with fresh recruits.",M:"ts_17",Et:[[...s(Nt,e),10]]}})),i.set(Z,(a,t,o)=>{let h=U(D(B(),0,1,50*t,100*t));return{label:"Obelisk",Yt:"exp",It:{type:n,title:"Obelisk",M:"ts_24",text:`The obelisk grants you ${h} experience!`,$t:()=>{Dt(a,o);let[t,s,e]=a.Bt.Rt(h),i="";s&&(i=Object.entries(e).map(([t,e])=>{var i=e-s[t];if(0<i)return t.toUpperCase()+`: ${e} (+${i})`}).filter(t=>t).join("<br/>"));var r=t?`You gained ${t} level(s)!<br/>`+i:"";r&&a.Ht({Yt:"gain_level",It:{type:n,title:"Level Up!",M:"ts_4",text:r,$t:()=>{}}})}}}}),{type:n,title:"Time is of the Essence",M:"ts_4"});i.set(tt,(t,e,i)=>({Yt:"new_turn",It:{...r,text:"The first day is done, and 12 days remain. Is there still enough time? The Kingdom is counting on you."}})),i.set(st,(t,e,i)=>({Yt:"new_turn",It:{...r,text:`Dawn of the next day... ${13-t.Bt.day} days remain to save the kingdom.`}})),i.set(et,(t,e,i)=>({Yt:"blip",It:{...r,text:"Dawn of the FINAL day. You MUST save the Kingdom by day's end or all is lost."}})),i.set(it,(t,e,i)=>({Yt:"fight",It:{...r,text:"You have failed to save the Kingdom. We are lost.",$t:()=>{window.location.reload()}}})),i.set(rt,(t,e,i)=>({It:{...r,text:"Hero! The kingdom is in peril!<br><br> You have 13 days to bring the <b>Crown of Light</b> to the capital city in the EAST.  The land is in chaos, and many of evil intent will try to stop you, but you must persevere.<br><br>If you fail in your quest, we will be lost.  Godspeed.",$t:()=>{I("new_turn")}}}))},S=t=>document.createElement(t),C=(t,e)=>t.appendChild(e),T=(t,e,...i)=>{var s,r=S(t);r.innerHTML=e;for(s of i)C(r,s);return r},zt=e=>{let i=e.onclick,s=(e.onclick=t=>{removeEventListener("keydown",s),i&&i.call(this,t)},t=>{"Enter"!==t.key&&" "!==t.key||e.onclick(t)});$(window,"keydown",s)},Bt=(t,e)=>{t.disabled=e,t.style.background=e?"grey":""},Lt=(t,e,f)=>{let v="div",c="p",p="span",i="position",g="height",w="display",m="align-items",b=(t,e)=>{Object.assign(t.style,e)},s=e,r=S(v),a=(b(r,{width:"100%",[g]:"100%",[i]:"fixed",[w]:"flex","justify-content":"center",[m]:"center",top:0,left:0}),r.id="dialog",S(v)),o=(b(a,{width:"675px",background:"#000",padding:"20px"}),C(r,a),{show:()=>{document.body.appendChild(r)},remove:()=>{r.remove()}}),h=s.store,x=(h&&(s.text=h.text,s.M=h.M),t=>{var e=S("img"),t=Xt(Wt(t));return e.src=t.toDataURL(),b(e,{width:"64px",[g]:"64px",imageRendering:"pixelated"}),e}),n=()=>{var{title:t,text:e,M:i}=s,t=T("b",t+"<br><br>"),t=(C(a,t),x(i)),i=(C(a,t),T(c,e));C(a,i)},y=()=>{var t=S(v),e=(b(t,{[i]:"relative",[w]:"inline-block"}),x("ts_18"));return b(e,{[i]:"absolute",transform:"translate(-12px, -38px)"}),C(t,e),t};switch(t){case"info":n();var l=S(c),k=(b(l,{textAlign:"right"}),T("button","OK"));k.onclick=()=>{o.remove(),e.$t&&e.$t()},zt(k),C(l,k),C(a,l);break;case"store":{n();let e=S(v),i=(t,s,r,a)=>{var o=S(v);b(o,{[g]:"150px",overflowY:"auto"});for(let i of t){let t=_(i),e=S(c);e.id="div_"+i;var h=r(t),n=f.Bt.zt>=h,h="<b>"+t.name+"</b> - "+h+" gold",h=T(p,h,y()),l=(t.Nt&&(l=It(t.Nt),l=T(p,l),b(l,{marginLeft:"54px"}),C(h,l)),T("button",s));b(l,{marginRight:"16px"}),l.onclick=()=>{a(i,t,e),d.remove(),u(),I("blip")},n&&i||Bt(l,!0),C(e,l),C(e,h),C(o,e)}C(d,o)},s=s=>{var t,r=S(v);b(r,{[g]:"154px"});for(let[t,e,i]of s){var a=M(t),o=S(v),h=`Units (${e}) - `+i+" gold",n=f.Bt.zt>=i,h=T(c,h,y()),h=(C(o,h),S(v)),a=(b(h,{[w]:"flex",flexDirection:"column",[m]:"flex-start"}),x("ts_"+a.xt)),l=T("button","Recruit");b(l,{marginTop:"8px"}),l.onclick=()=>{f.Bt.zt>=i&&(f.Bt.zt-=i,f.Bt.unit[1]+=e,s.splice(0,1),d.remove(),u(),I("blip"),f.map.Ot[f.Bt.y*f.map.w+f.Bt.x].jt=!0)},n||Bt(l,!0),C(h,a),C(h,l),C(o,h),C(r,o)}s.length||(t=T(c,"You have already recruited these units."),b(t,{color:"grey"}),C(r,t)),C(d,r)},d,u=()=>{d=S(v);var t=T(v,"You have "+f.Bt.zt+" gold",y());b(t,{color:"yellow"}),C(d,t),h.items&&(C(d,T(c,"<b>BUY ITEMS</b>")),i(h.items,"Buy",t=>t.Ct,(e,t,i)=>{f.Bt.zt>=t.Ct&&(f.Bt.zt-=t.Ct,f.Bt.Lt(e),h.items=h.items.filter(t=>t!==e),i.remove())}),C(d,T(c,"<b>SELL ITEMS</b>")),i(f.Bt.items,"Sell",t=>t.Tt,(t,e,i)=>{f.Bt.zt+=e.Tt,f.Bt.removeItem(t),i.remove()})),h.Et&&s(h.Et),C(e,d)};u(),C(a,e);k=S(c),l=(b(k,{textAlign:"right"}),T("button","OK"));l.onclick=()=>{o.remove()},zt(l),C(k,l),C(a,k);break}case"battle":{var l=T("b","Battle<br><br>"),k=(C(a,l),S(v)),[l,k]=(C(a,k),N(650,350)),l=(C(a,l),S(v));b(l,{[w]:"flex","justify-content":"center",marginTop:"4px"});let e=T("button","Retreat"),i=(e.onclick=()=>{t.$("retreat"),o.remove()},b(e,{marginRight:"16px"}),C(l,e),T("button","FIGHT!")),t=(i.onclick=()=>{s.Ft.start();var t=t=>{t.style.visibility="hidden"};t(i),t(e),I("fight")},C(l,i),C(a,l),s.Ft);t.F(k,o,a)}}return o},Et={font:"monospace",color:"#fff",size:14,align:"center",strokeColor:"black"},Rt="imageSmoothingEnabled",Ht=1,jt=t=>{Ht=t},Ft=()=>{var t=y();b(0,0,t.width,t.height,"#333")},m=(t,e,i,s,r)=>{s=s||1,r=r||k();var a="string"==typeof t?Wt(t):t;if(!a)throw new Error(`No sprite: "${t}"`);var[t,a,o,h,n]=a;r.drawImage(t,a,o,h,n,e,i,h*s,n*s)},b=(t,e,i,s,r,a,o)=>{a=a?"stroke":"fill";(o=o||k())[a+"Style"]=r,o[a+"Rect"](t,e,i,s)},x=(t,e,i,s,r)=>{var{font:s,size:a,color:o,align:h,strokeColor:n}={...Et,...s||{}};(r=r||k()).font=a+"px "+s,r.textAlign=h,r.textBaseline="middle",n&&(r.strokeStyle=n,r.lineWidth=4,r.strokeText(t,e,i)),r.fillStyle=o,r.fillText(t,e,i)},Pt=null,Kt={},Ut={},Gt=t=>{var[e,i,s]=N(t.width,t.height);return i.translate(s,0),i.scale(-1,1),i.drawImage(t,0,0),e},Xt=t=>{var[,,,e,i]=t,[e,i]=N(e,i);return m(t,0,0,1,i),e},Vt=(n,i,s,r,a)=>{let u=(t,e,i,s,r,a)=>{var[o,h]=N(r,a);return h.drawImage(e,i,s,r,a,0,0,r,a),n[t]=[o,0,0,r,a]},o=(t,e,i)=>{var[s,r]=N(t[3],t[4]),a=(m(t,0,0,1,r),r.getImageData(0,0,s.width,s.height)),o=a.data;for(let t=0;t<o.length;t+=4){var h,n,l,d=`${o[t]},${o[t+1]},`+o[t+2],d=i.get(d);d&&([d,h,n,l]=d.split(",").map(t=>parseInt(t)),o[t+0]=d,o[t+1]=h,o[t+2]=n,o[t+3]=l)}return r.putImageData(a,0,0),u(e,s,0,0,t[3],t[4])},h=i.width/r,t=i.height/a;for(let e=0;e<t;e++)for(let t=0;t<h;t++){var l=s+"_"+(e*h+t),d=u(l,i,t*r,e*a,r,a),f=Gt(Xt(d)),f=u(l+"_f",f,0,0,r,a),v=new Map;v.set("47,191,218","255,83,74,255"),v.set("77,97,156","169,59,59,255"),o(d,l+"_r",v),o(f,l+"_r_f",v)}},qt=async t=>{y();let o={},h={};await Promise.all(t.map(([i,s,r,a],t)=>new Promise(t=>{let e=new Image;e.onload=()=>{o[i]=e,Vt(h,e,i,r,a),t()},e.src=s}))),Kt=o,Ut=h},N=(t,e)=>{var i=document.createElement("canvas"),s=(i.width=t,i.height=e,i.getContext("2d"));return s[Rt]=!1,[i,s,t,e]},y=()=>{if(Pt)return Pt;{let[i,s]=N(576,576);i.id="canv",s.lineWidth=2,window.cdv.appendChild(i);var t=()=>{var[t,e]=N(i.width,i.height);e.drawImage(i,0,0),i.width=window.innerWidth,i.height=window.innerHeight,s[Rt]=!1,s.drawImage(t,0,0)};return $(window,"resize",t),t(),Pt=i}},k=()=>y().getContext("2d"),Wt=t=>Ut[t],Jt=t=>"canv"===t.target?.id,O={Pt:0,Kt:0,scale:1,Ut:0,Gt:0,Xt:0,Vt:0,qt:!1,Wt:0,Jt:0},Qt=()=>O,Zt=()=>y().getBoundingClientRect()||{left:0,top:0,width:0,height:0},te=(t,e,i)=>{var[t,e]=ie(t,e),t=Math.round(t-i/O.scale*(t-O.Pt)),e=Math.round(e-i/O.scale*(e-O.Kt));O.Pt=t,O.Kt=e,O.scale=i},ee=(t,e)=>{var i,s=y();s&&(i=O.scale,t=s.width/2-t,s=s.height/2-e,O.Pt=t,O.Kt=s,O.scale=1,te(t,s,i))},ie=(t,e)=>{var{left:i,top:s}=Zt();return[t-i,e-s]},se=(t,e,i)=>{var[t,e]=ie(t,e),s=y();return s?(s.width,s=t-O.Pt,t=e-O.Kt,[s/O.scale,t/O.scale]):[0,0]},re=(t,e,i)=>{let[s,r]=se(t,e,i),a=Math.floor(s/16);a%2==1&&(a=Math.floor((s-8)/16));var o,h,t=Math.floor(r/12);for([o,h]of[[a,t],...Ne([a,t])])if(De([o,h],[0,0,i.map.w,i.map.Qt])){var n=h%2==0?Ie([16*o,12*h,16,16]):Ie([8+16*o,12*h,16,16]);if($e([Math.floor(s),Math.floor(r)],n))return[o+i.map.w*h,o,h,s,r]}return s>16*i.map.w||r>16*i.map.Qt||s<0||r<0?[-1,a,t,s,r]:[t*i.map.w+a,a,t,s,r]},ae=l=>{$(window,Oe,t=>{"canv"===t.target.id&&(t.preventDefault(),1===t.button||2===t.button||0===t.button)&&Jt(t)&&(O.Ut=t.clientX,O.Gt=t.clientY,O.Xt=O.Pt,O.Vt=O.Kt,O.qt=!0)}),$(window,Ae,t=>{var e,i;O.Wt=t.clientX,O.Jt=t.clientY,O.qt?(O.Pt=O.Xt+t.clientX-O.Ut,O.Kt=O.Vt+t.clientY-O.Gt):([t,e,i]=re(t.clientX,t.clientY,l),(t=l.map.Ot[t])!==l.Zt&&(l.Zt=t))}),$(window,Ye,t=>{if(O.qt){var e=O.Xt+t.clientX-O.Ut,i=O.Vt+t.clientY-O.Gt,s=O.Ut-t.clientX,r=O.Gt-t.clientY;if(Math.abs(s)<10&&Math.abs(r)<10&&0===t.button){if(l.te())return;var[s,r,t]=re(t.clientX,t.clientY,l),a=be(l.map,[r,t]),{x:o,y:h}=l.Bt,{path:n,Ct:a}=xe(a,l.map.w,[o,h],[r,t]);if(a<100)if(l.Bt.ee===s){l.Bt.ie=!1,l.Bt.se=0;let s=!1,r=ze(n,l),t=n[r],e=l.map.Ot[t[0]+t[1]*l.map.w],a;for(let t=1;t<n.length;t++){let[e,i]=n[t];if(l.N.p(d(50,()=>{},()=>{var t=l.map.Ot[e+i*l.map.w],t=mt(t.id);l.Bt.x=e,l.Bt.y=i,s=l.Bt.re(t),l.map.ae([e,i]),I("horse_step"),s&&(t=12==(t=13-l.Bt.day)?tt:1==t?et:0==t?it:st,a=w(t)(l,0,0))})),t>=r)break}l.N.p(d(50,()=>{},()=>{let t=e.event;t?a?(a.It.$t=()=>{l.Ht(t)},l.Ht(a)):l.Ht(t):a&&l.Ht(a)}))}else l.Bt.ee=s,l.Bt.path=n,l.Bt.se=a,l.Bt.ie=!0}O.Pt=e,O.Kt=i,O.qt=!1}}),$(window,"contextmenu",t=>{Jt(t)&&t.preventDefault()}),$(window,"wheel",e=>{if(Jt(e)){let t=O.scale;0<e.deltaY?--t:t+=1,10<t?t=10:t<1&&(t=1),te(e.clientX,e.clientY,t)}}),$(window,"keydown",t=>{l.te()||" "===t.key&&(t=l.map.Ot[l.Bt.x+l.Bt.y*l.map.w].event)&&l.Ht(t)})},oe=(t,e)=>{var[t,i]=t,t=M(t),t=F(t,i);return[l(t,{X:e}),i]},he=()=>{var t=Qt();return{x:t.Pt,y:t.Kt,scale:t.scale}},ne=(t,e)=>{if(t.At){var i,s,r,a,o=[],h=[];for([i,s]of t.At.units){var n=M(i),n=F(n,s);o.push(n)}for([r,a]of e){var l=M(r),l=F(l,a);h.push(l)}return{units:o,oe:h,X:void 0}}},Y=[n,u,c];class le{x;y;R=!1;path=[];ee;ie=!1;color="blue";he=t(100,1/0,2);unit;zt=100;level=0;exp=0;ne=[];items=[];le=new Ce(20);day=0;se=0;X={[n]:0,[u]:0,[c]:0};constructor(){this.x=5,this.y=9,this.le.start(),this.unit=[p,50],h(this.he)}re(t){var e=this.le,i=e.ms;return e.update(t),!!e.l()&&(this.day++,e.s=e.s%i,!0)}Rt(t){let e=t+this.exp,i=0,s=t=>100*(t+1)*1.25,r={...this.X},a=()=>{for(var t of Y)this.X[t]+=.25<B()?1:0},o=s(this.level);for(;e>=o;){var h=this.exp-o;this.exp+=h,t-=h,e=t+this.exp,this.level++,o=s(this.level),i++,a()}return this.exp+=t,[i,r,this.X]}Lt(t){this.items.push(t);var s=_(t);for(let i=0;i<Y.length;i++){let t=Y[i],e=0;s.Nt&&(e+=s.Nt[t]??0),this.X[t]+=e}}removeItem(r){var t=this.items.indexOf(r);if(-1<t){this.items.splice(t,1);for(let s=0;s<Y.length;s++){let t=Y[s],e=0,i=_(r);i.Nt&&(e+=i.Nt[t]??0),this.X[t]-=e}}}update(t){a(this.he,t)}ct(t,e,i){m("ts_4"+(this.R?"_f":""),t,e,i),m("ts_"+(25+this.he.o)+"_f",t-4*i,e-6*i,i)}}class de{id;o;x;y;bt;event;jt=!1;de=t(500,1/0,1);px;ue;constructor(){h(this.de)}update(t){a(this.de,t)}ct(s,r,a,t=!1,e){if(this.px=s,this.ue=r,t)m("ts_39",s,r,a);else{if(m(this.bt,s,r,a),this.event?.At){let[t]=this.event.At.units[0],e=M(t),i=0;this.de.o&&(i=-1*a),m("ts_"+e.xt+"_r_f",s,r+i,a)}this.jt&&m("ts_"+(25+e.o)+"_r",s+a/2,r-7*a,a)}}}class ue{w;Qt;name;Ot=[];fe=[];constructor(e,t){var t=this.name=t,i=K.get(t);this.w=i.width,this.Qt=i.height;for(let t=0;t<this.w*this.Qt;t++){var s,r=new de,a=(r.id=i.data[t],r.bt="ts_"+(r.id-1),r.o=t,r.x=t%this.w,r.y=Math.floor(t/this.w),i.St.get(t));a&&([a,s]=a,a=w(a),r.event=a(e,s,t)),this.Ot.push(r)}this.fe=new Array(this.w*this.Qt).fill(!0)}ve(t){var{x:e,y:i,scale:s}=he(),r=+s,a=t.canvas,o=(this.w,this.Qt,a.width/2),a=a.height/2,o=o-r/s*(o-e),e=a-r/s*(a-i);t.save(),t.translate(o,e)}ae([i,s]){for(let e=-3;e<=3;e++)for(let t=-3;t<=3;t++){var r=i+e,a=s+t;0<=r&&0<=a&&r<this.w&&a<this.Qt&&(this.fe[a*this.w+r]=!1)}}update(t){for(var e of this.Ot)e.update(t)}ct(e,r){this.ve(k());let t=he().scale,a=+t,o=this.w,i=this.Qt,h=-1,n=-1;for(let s=0;s<i;s++){var l=s%2==1?8:0;for(let i=0;i<o;i++){var d=s*o+i,u=this.Ot[d],f=(16*i+l)*a,v=12*s*a;if(u.ct(f,v,a,this.fe[d],e.he),e.ie){d=e.path.findIndex(([t,e])=>t===i&&e===s);if(-1<d){let t="white";ze(e.path,r)<d&&(t="black"),b(f+8*a-4,v+8*a-4,8,8,t),b(f+8*a-2,v+8*a-2,4,4,d===e.path.length-1?u.event?.At?"red":t:"green")}}e.x===i&&e.y===s&&(h=f,n=v)}0<h&&0<n&&e.ct(h,n,a)}k().restore()}}class fe{map;Ft;Bt=new le;N=new E;Zt;constructor(){this.map=new ue(this,"map"),this.map.ae([this.Bt.x,this.Bt.y]),this.Bt.Lt(0),Qt().scale=4,ee(16*this.Bt.x*4,16*this.Bt.y*4),this.Ht(w(rt)(this,0,0))}te(){return!!this.N.v()||!!this.Ft||!!document.getElementById("dialog")}Ht(a){if(a.Yt&&I(a.Yt),Qt().qt=!1,a.At){let t=ne(a,[this.Bt.unit]),i=new H(t.oe.map(t=>t),t.units.map(t=>t),this.Bt.X),e=Lt("battle",{Ft:i},this),s=a.At.Dt,r=this.map.Ot[s];ee(r.px,r.ue),(this.Ft=i).$=t=>{var e;this.Ft=void 0,"win"===t&&(Dt(this,s),this.Bt.unit[1]=i.C.k,I("blip")),"retreat"===t&&(e=this.Bt.path[this.Bt.path.length-2],this.Bt.x=e[0],this.Bt.y=e[1]),"lose"===t&&this.Ht(w(it)(this,0,0))},e.show()}a.It&&Lt(a.It.type,{title:a.It.title,text:a.It.text,M:a.It.M,$t:a.It.$t},this).show(),a.store&&Lt("store",{title:"Vendor",store:a.store,$t:()=>{}},this).show()}update(t){this.N.update(t),this.Bt.update(t),this.map.update(t),this.Ft&&this.Ft.update(t)}ct(){this.map.ct(this.Bt,this);var e=k().canvas.height-250,i={align:"left",size:16};for(let t=0;t<this.Bt.items.length;t++){var s=this.Bt.items[t],s=_(s);x(s.name,50,e+-18*(t+2),i)}x("Gold: "+this.Bt.zt,82,e,i),m("ts_18",28,e-33,4),x("Level: "+(this.Bt.level+1),50,36+e,i);var r=[n,u,c];for(let t=0;t<r.length;t++){var a=r[t];x(a.toUpperCase()+": "+this.Bt.X[a],50,e+18*(t+3),i)}var[t,o]=oe(this.Bt.unit,this.Bt.X),h=126+e;if(x("Troop Rating: "+t,50,h-16,{align:"left"}),m("ts_4",50,h,4),x(o+"",92,64+h),x("Day: "+(this.Bt.day+1)+"/13",50,40,{align:"left"}),b(48,56,200,16,"black"),b(50,58,196*(1-this.Bt.le.ce()),12,"grey"),t=this.Bt.le.s,this.Bt.le.s=t+this.Bt.se,o=this.Bt.le.ce(),this.Bt.le.s=t,b(50,58,196*(1-o),12,"white"),this.Ft&&this.Ft.ct(),this.Zt&&!this.map.fe[this.Zt.o]){let t=this.Zt.event?.label??"",e="",i="white",s,r,a,o,h,n=he().scale;this.map.ve(k()),this.Zt.x===this.Bt.x&&this.Zt.y===this.Bt.y&&([s]=oe(this.Bt.unit,this.Bt.X),e="Heros Army ("+this.Bt.unit[1]+")",t="Troop Rating: "+s),t&&(this.Zt.event?.At&&(r=ne(this.Zt.event,[]),t+=": "+r.units.map(t=>t.label+` (${t.k})`).join(", "),a=l(r.units[0],{}),o=e="Troop Rating: "+a,[h]=(e=t,t=o,oe(this.Bt.unit,this.Bt.X)),h<a?i="#F33":a<h&&(i="#3F3")),x(t,this.Zt.px+8*n,this.Zt.ue,{color:i}),e)&&x(e,this.Zt.px+8*n,this.Zt.ue-16),k().restore()}}}window.addEventListener("load",()=>{ce()});let ve=10,ce=async()=>{await pe();var t=new fe;ae(t),ge(t)},pe=async()=>{await wt()},ge=i=>{let s=Me(),r=D(22,16,30,1,2),t=()=>{Ft(),i.ct(),requestAnimationFrame(t)};setInterval(()=>{var t=Me(),e=t-s,t=(s=t,e),e=(4<e?4:e)*r/ve;jt(e),i.update(Math.min(t,33)),window.pe=i},22),t()},we=(window.ge=t=>{t=.3*Number(t.value)/100;Le(t)},{width:35,height:19,data:"2 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 2 4 4 4 4 25,1 1 1 4 4 4 4 25,2 4 4 4 4 4 4 4 4 4 4 4 4 4 2 4 4 2 1 10,1 4 10,1 1 1 1 4 4 3 1 1 1 1 4 10,2 4 1 1 4 4 4 1 2 10,1 10,3 4 4 4 4 4 2 2 4 2 1 1 1 1 1 1 2 11,1 4 1 1 18,1 1 4 1 1 1 3 2 1 4 1 1 1,2 11,1 4 10,1 10,4 4 4 2 20 2 4 2 10,2 1 18,2 2 1 1 2 1 10,1 4 1 9 9 1 1,2 4 1 3 1 1 1 1 1 3 2 4 4 1 4 4 2 20 20 4 2 1 1 1 1 2 9,1 9 1 10,1 4 1 9 1 1 4 4 4 4 1 1 1 1 18,2 1 1 2 17,4 1 4 4 20 12,1 20 4 2 1 1 1 1 1 2 4 9 2 4 1 1 9 9 1 4 4 4 9,2 9 9 25,1 9 9 9 9 2 9 18,3 4 4 4 9 4 2 1 4 4 2 20,1 2 4 9 2 2 1 9 17,1 9 9,1 9 9 9 4 1 9 9 1 1 1 1 2 9 9 4 4 4 9,4 4 2 1 1 4 2 20 20 4 9 2 2 1 9 3 3 2 3 1 1 1 4 4 1 1 1 4 1 1 4 9 1 4 4 9,4 4 2 2 25,2 4 20 12 20 4 9,1 2 2 9 3 1 2 4 4 1 10,1 10,2 4 4 1 2 4 4 1 3 4 9 18,2 4 4 9,4 4 2 2 4 4 1 9 9 9 9 2 2 9 3 1 4 4 4 4 4 4 4 4 2 1,2 4 4 4 1,2 2 4 9 9,3 9 9 4 2 4 2 3 1 9 9 1 1 25,1 9,1 2 1 4 4 4 10,2 4 4 4 4 25,2 1 2 4 4 3 3 2 4 4 9 9 9 4 4 4 2 2 1 1 18,1 9 1 1 9 2 2 3 4 4 3 3 4 1 1 1 1 1 2 1 3 3 1 2 4 4 9 9 4 4 4 2 2 1 2 1 9 9 9 9 2 4 4 4 25,1 1 4 1 1 1 1 9 9 2 1 18,2 9 1 1 4 9 9 9 4 4 4 2 2 2 1 1 1 17,1 9 9 11,1 4 4 11,1 1 1 9 9,2 9 17,1 1 9 2 9 9,3 9 9 9 1 1 4 9 1 4 4 10,1 2 2 1 3 1 1 1 9 10,1 4 4 4 1 1 9 4 4 9 9 9 9 10,1 9 2 2 2 9 9,3 4 4 9 2 4 4 2 11,1 2 1 1 3 1 3 1 9 10,1 4 4 18,2 9 9 1 4 1 18,1 1 2 2 2 2 2 10,1 1,2 4 9 9 4 9,3 4 2 10,1 1,1 1 1 3 1 25,1 1 1 1 9 9 9,2 9 9 1 4 4 1 1 1,3 10,1 11,1 10,1 2 11,2 10,3 2 4 4 9 9 9 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 4 4 4 2 2 2 2 2 2 2 2 2 2 2 2 10,1 10,1 2".split(" ")}),A=([t,e])=>t+","+e,me=(t,e)=>t%e+","+Math.floor(t/e),be=(t,e)=>{var i,s=[];for(i of t.Ot){let t=mt(i.id);i.event&&!Se([i.x,i.y],e??[-1,-1])&&(t=100),s.push(t)}return s},xe=(e,i,t,s)=>{var r,a=e.length/i,o=new Map,h=new Map,n=[[0,t]];for(let t=0;t<e.length;t++)o.set(me(t,i),1/0);for(o.set(A(t),0);0<n.length;){n.sort((t,e)=>t[0]-e[0]);var l,d,u,[f,[v,c]]=n.shift();for([l,d]of Ne([v,c]))u=l,r=d,De([u,r],[0,0,i,a])&&(u=f+_e([l,d],e,i))<o.get(A([l,d]))&&(o.set(A([l,d]),u),h.set(A([l,d]),[v,c]),n.push([u,[l,d]]))}var p=[];if(h.get(A(s))){let t=[],e=s;for(;e;)t.push(e),p.push(o.get(A(e))),e=h.get(A(e));return{path:t.reverse(),Ct:o.get(A(s)),we:p.reverse()}}return{path:[],Ct:1/0,we:p}},ye=()=>({x:0,y:0,M:"",H:"",scale:1,offsetX:0,offsetY:0,filter:"",R:!1}),ke=(t,e)=>{(e=e??k()).save(),t.filter&&(e.filter=t.filter),m(t.M+(t.H?"_"+t.H:"")+(t.R?"_f":""),t.x+t.offsetX,t.y+t.offsetY,t.scale,e),e.restore()},Me=()=>window.performance.now(),D=(t,e,i,s,r)=>s+(t-e)*(r-s)/(i-e),_e=([t,e],i,s)=>t<0||s<=t||e<0||s<=e?-1/0:i[t+e*s],Se=(t,e)=>t?.[0]===e?.[0]&&t?.[1]===e?.[1];class Ce{ms;s=-999;constructor(t){this.ms=t}start(){this.s=0}stop(){this.s=-1}ce(){return Math.max(0,Math.min(1,this.s/this.ms))}complete(){this.s=-999}l(){return this.s>=this.ms}update(t){0<=this.s&&(this.s+=t)}}let Te={},I=t=>{t=bt(t);Ee(t)},Ne=([t,e])=>e%2==0?[[t-1,e],[t+1,e],[t-1,e-1],[t,e-1],[t-1,e+1],[t,e+1]]:[[t-1,e],[t+1,e],[t,e-1],[t+1,e-1],[t,e+1],[t+1,e+1]],Oe="mousedown",Ye="mouseup",Ae="mousemove",$=(t,e,i)=>{t.addEventListener(e,i)},De=(t,e)=>t[0]>=e[0]&&t[0]<=e[0]+e[2]&&t[1]>=e[1]&&t[1]<=e[1]+e[3],Ie=t=>{var[t,e,i,s]=t,r=i/2,a=s/4;return[[t+r,e],[t+i,e+a],[t+i,e+3*a],[t+r,e+s],[t,e+3*a],[t,e+a]]},$e=(e,i)=>{let s=!1,r=0;for(let t=0;t<i.length;t++){(r=t+1)==i.length&&(r=0);var a=i[t],o=i[r];(a[1]>=e[1]&&o[1]<e[1]||a[1]<e[1]&&o[1]>=e[1])&&e[0]<(o[0]-a[0])*(e[1]-a[1])/(o[1]-a[1])+a[0]&&(s=!s)}return s},ze=(t,e)=>{let i=0,s=e.Bt.le.s;for(i=1;i<t.length;i++){var[r,a]=t[i],r=e.map.Ot[r+a*e.map.w],a=mt(r.id);if((s+=a)>=e.Bt.le.ms)break}return i>=t.length?i-1:i},Be=t=>t.map(t=>({me:t,s:Math.random()})).sort((t,e)=>t.s-e.s).map(({me:t})=>t),Le=($(window,"keydown",t=>{Te[t.key]=!0}),$(window,"keyup",t=>{Te[t.key]=!1}),t=>{He=t}),Ee=t=>{Re(...t)},Re=(...t)=>Fe(Pe(...t)),He=.3,z=44100,je=new(window.AudioContext||webkitAudioContext),Fe=(...t)=>{let i=je.createBuffer(t.length,t[0].length,z),e=je.createBufferSource();return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(je.destination),e.start(),e},B=Math.random,Pe=(t=1,e=.05,i=220,s=0,r=0,a=.1,o=0,h=1,n=0,l=0,d=0,u=0,f=0,v=0,c=0,p=0,g=0,w=1,m=0,b=0)=>{let x=2*Math.PI,y=n*=500*x/z/z,k=i*=(1+2*e*B()-e)*x/z,M=[],_=0,S=0,C=0,T=1,N=0,O=0,Y=0,A,D;for(s=s*z+9,m*=z,r*=z,a*=z,g*=z,l*=500*x/z**3,c*=x/z,d*=x/z,u*=z,f=f*z|0,D=s+m+r+a+g|0;C<D;M[C++]=Y)++O%(100*p|0)||(Y=o?1<o?2<o?3<o?Math.sin((_%x)**3):Math.max(Math.min(Math.tan(_),1),-1):1-(2*_/x%2+2)%2:1-4*Math.abs(Math.round(_/x)-_/x):Math.sin(_),Y=(f?1-b+b*Math.sin(x*C/f):1)*(0<Y?1:-1)*Math.abs(Y)**h*t*He*(C<s?C/s:C<s+m?1-(C-s)/m*(1-w):C<s+m+r?w:C<D-g?(D-C-g)/a*w:0),Y=g?Y/2+(g>C?0:(C<D-g?1:(D-C)/g)*M[C-g|0]/2):Y),A=(i+=n+=l)*Math.cos(c*S++),_+=A-A*v*(1-1e9*(Math.sin(C)+1)%2),T&&++T>u&&(i+=d,k+=d,T=0),!f||++N%f||(i=k,n=y,T=T||1);return M};