document.write('<title>XIII Days To Save The Kingdom</title><body><style>body{background:#333;margin:0;font-family:monospace;color:#fff}button{color:#fff;background:#333;font-family:monospace;min-width:100px}</style><div class=canvas-div id=canvasDiv></div>');let t=(t,e,i)=>({t:new Se(t),i:new Se(e),o:0,h:i,active:!1}),h=t=>{t.active=!0,t.o=0,t.t.start(),t.i.start()},L=t=>{t.active=!1},a=(t,e)=>{t.active&&(t.t.update(e),t.i.update(e),t.t.l()&&(t.o=(t.o+1)%(t.h+1),t.t.start()),t.i.l())&&L(t)};class j{controls=[];u;v(){return this.u}p(t){this.controls.push(t)}update(t){var e=this.u;e&&(e.t.update(t),e.t.l())&&(e.commit(),this.controls.shift(),this.u=void 0),this.controls.length&&(t=this.controls[0],this.u||((this.u=t).init(),t.t.start()))}}let d=(t=100,e=()=>{},i=()=>{})=>({init:e,commit:i,t:new Se(t)}),n=(t,e)=>{let i=t.g(o,e)-5,s=t.g(l,e),r=(1+A(i+s+0+1,1,10,0,100)/100).toFixed(2),a=r.split(".")[1];for(;a.length<2;)r+="0",a=r.split(".")[1];return r},B=t=>{var e,i=s(0);i.m.scale=8;for(e of t)i.k=e.k,i[o]=e[o],i[v]=e[v],i[l]=e[l],i[f]=e[f],i[u]=e[u],i[c]=e[c],i.m.M=e.m.M,i.label=e.label;return i};class H{_;S;C;N;O=new j;T;I="";Y=!1;A;$;D=t=>{};L=0;j=0;constructor(t,e,i,s){this._=i,this.S=s,this.C=B(t),this.C.m.M="ts_4",this.C.label="Hero's Army",this.N=B(e),this.N.m.B=!0,this.N.m.H="r";i=this.F(this.C);this.L=this.C.g(v,i),this.j=this.N.g(v,{})}P(t,e,i){var{width:t,height:s}=(this.T=t).canvas,t=(this.C.R(t/2-96-64,s/2-64),this.N.R(t/2+96-64,s/2-64),y("div")),s=(Object.assign(t.style,{height:"100px",overflowY:"scroll",background:"#333",color:"white"}),k(i,t),this.$=t,y("p")),t=(Object.assign(s.style,{textAlign:"right"}),M("button","OK"));t.onclick=()=>{e?.remove(),this.D(this.I)},t.style.visibility="hidden",this.A=t,k(s,t),k(i,s)}G(t,e){return{U:t,V:e}}F(t){return{X:this.K(t)}}q(...t){this.$&&(t=(t.join(" ")+"<br>").replace(/\s/g,"&nbsp;"),t=M("span",t),k(this.$,t),this.$.scrollTop=this.$.scrollHeight)}W(t){return t===this.C?"left":"right"}K(t){return t===this.C?this._:this.S}J(t,e){var i=this.G(t,e),s=e.g(l,{...i,X:this.K(e)}),i=Math.max(1,t.g(o,{...i,X:this.K(t)})-s),s=Math.max(1,i-Math.floor(i*t[c])-s);return{Z:s,tt:i,et:this.st(e,s*t.k).it,rt:this.st(e,i*t.k).it}}st(t,e){let i=t[u]+(t.k-1)*t[f],s=(i-e)%t[f],r=(0===s&&(s=t[f]),Math.ceil((i-e)/t[f]));return r<=0&&(r=0),{ot:s,it:r}}ht(t,e){let i=!1;this.G(t,e).X=this.K(e);var{Z:s,tt:r,et:a,rt:o}=this.J(t,e),h=Math.round(Math.max(1,A(D(),0,1,s,r)))*t.k,{it:n,ot:l}=this.st(e,h),d=e.k-n;n<=0&&(i=!0),this.q(t.label,"attacks",e.label,"for",h,"damage, defeating",d,"units."),this.q(" --\x3e",`min damage was ${s*t.k} (defeating ${e.k-a})`),this.q(" --\x3e",`max damage was ${r*t.k} (defeating ${e.k-o})`),e[u]=l,e.k=n,i}nt(){return!!this.I||(0===this.C.k?(this.I="lose",this.C.visible=!1,this.A?.style.setProperty("visibility","visible"),zt(this.A),$("lose"),!0):0===this.N.k?(this.I="win",this.N.visible=!1,this.A?.style.setProperty("visibility","visible"),zt(this.A),$("battle_win"),!0):void 0)}lt(){if(!this.nt()&&!this.O.u){let r=this.L>=this.j?[this.C,this.N]:[this.N,this.C],a=0,o=()=>{if(!(a>=r.length)){let t=r[a],e="left"===this.W(t),i=e?this.C:this.N,s=e?this.N:this.C;a++,this.O.p(d(300,()=>{h(i.ut.dt)},()=>{this.ht(t,s),$("attack"),0===s.k&&($("flicker_enemy"),h(s.ut.ft)),L(i.ut.dt)})),this.O.p(d(300,()=>{},()=>{0===s.k&&(L(s.ut.ft),s.vt=!0),this.nt()||o()}))}};o()}}start(){this.Y=!0}update(t){this.C.update(t),this.N.update(t),this.O.update(t),!this.O.u&&this.Y&&this.lt()}ct(){var e=this.T;if(e){S(0,0,e.canvas.width,e.canvas.height,"#555",!1,e);var i=Math.ceil((e.canvas.width+19)/19);for(let t=0;t<i**2;t++)S(t%i*19-19,19*Math.floor(t/i),19,19,`rgba(52,221,5,${A(Math.abs(Math.sin(19*t*3)),0,1,.3,.5)})`,!1,e);this.C.ct(this.T,this.Y?"":this.L),this.N.ct(this.T,this.Y?"":this.j),this.Y||(t=this.L>=this.j?this.C:this.N,s=this.L>=this.j?"lightgreen":"red",C(t.label+" will go first!",e.canvas.width/2,e.canvas.height-50,{size:22,color:s},e));var t=this.F(this.C),s=n(this.C,t),t=n(this.N,{});this.I||(C("Troop Rating: "+s,12,12,{size:14,align:"left",strokeColor:""},e),C("Troop Rating: "+t,e.canvas.width-12,12,{size:14,align:"right",strokeColor:""},e)),"win"===this.I&&C("Victory!",e.canvas.width/2,30,{size:28},e),"lose"===this.I&&C("Defeat...",e.canvas.width/2,30,{size:28},e)}}}let o="attack",l="defense",u="health",f="maxHealth",v="speed",c="attackVarPct",F=()=>({wt:t(50,949494,1),dt:t(75,225,1),ft:t(100,300,1)}),P=(t,e)=>{var i=s(t.gt);return i.k=e,Object.assign(i,t),i.bt="ts_"+t.xt,i.m.M=i.bt,i},s=(t=w)=>{let e=xe(),i={yt:t,label:"Footman",k:0,bt:"ts_20",kt:[0,0],X:void 0,Mt:"player",visible:!0,vt:!1,_t:void 0,ut:F(),O:new j,m:e},s=(i[o]=1,i[l]=1,i[u]=1,i[f]=1,i[v]=1,i[c]=0,e.M=i.bt,{R(t,e){r.kt=[t,e],r.m.x=t,r.m.y=e},getBounds:()=>[r.m.x,r.m.y,64,64],g:(t,e)=>{e=e.X?.[t]??0,t=Number(r[t]);return Math.max(0,t+e+0)},update:t=>{var e;r.O.update(t),a(r.ut.dt,t),r.ut.dt.active?(e=r.m.B?-1:1,r.m.offsetX=(r.ut.dt.o?0:-4)*e):r.m.offsetX=0,a(r.ut.ft,t),r.ut.ft.active?r.visible=!!r.ut.ft.o:r.visible=!0},ct:(t,e)=>{r.visible&&!r.vt&&(ye(r.m,t),C(""+r.k,r.m.x+(r.m.H?8:16*r.m.scale-8),r.m.y,{size:28},t),e)&&C("Speed: "+e,r.m.x+16*r.m.scale/2,r.m.y+16*r.m.scale,{size:16},t)}}),r={...i,...s};return r},i=new Map,R=new Map,G=new Map,U=t=>5*Math.ceil(t/5),V=0,X=1,K=2,q=3,W=4,J=5,Q=6,Z=7,tt=8,et=11,it=12,st=13,rt=14,w=0,at=1,ot=2,ht=3,nt=4,lt=5,dt=6,ut=7,ft=8,vt=9,ct=10,wt=11,p=12,pt=13,gt=async()=>{yt(),window.asdf&&Le([]),xt(),It(),Et(),$t(),Ct();var t=[Kt([["ts","ts.png",16,16]]),kt()];await Promise.all(t)},mt=t=>G.get(t-1)??100,bt=t=>{var e=i.get(t);if(e)return e;throw new Error("No sound: "+t)},g=t=>{var e=x.get(t);if(e)return e;throw new Error("No event: "+t)},m=t=>{var e=Nt.get(t);if(e)return e;throw new Error("No unit: "+t)},b=t=>{var e=r.get(t);if(e)return e;throw new Error("No item: "+t)},xt=()=>{var e=[0,1,2,3,8,9,10,11,16,17,18,19,24],i=[1,100,2,100,.5,1,1,1,1,1,1,100,1];for(let t=0;t<e.length;t++)G.set(e[t],i[t])},yt=()=>{i.set("item",[,,397,.02,.05,.18,1,2.3,,-23,465,.06,.06,,,,,.56,.02]),i.set("army_defeated",[,0,855,.37,.03,.21,4,3,-1,85,-124,.79,.13,,,,.23,.84,.02,.15,891]),i.set("lose",[1.3,,31,,.19,.004,3,4,,,-329,.33,,,35,,.37,,.4,.03]),i.set("exp",[1.4,0,667,.03,.31,.41,,2.1,.4,-.3,125,.05,.08,,,,.09,.98,,.08]),i.set("horse_step",[1.2,,750,.01,,.008,3,1.4,15,,,,,,62,,.06,.53]),i.set("attack",[1.4,,101,.02,.06,.05,4,2.8,,,,,.09,1.8,,.4,.05,.74,.09,.49,1660]),i.set("flicker_enemy",[2.3,,456,,,.28,,1.7,4,,,,.07,1.7,,.1,.15,.66,.04,.44]),i.set("gold",[,,975,.03,.01,.008,1,4.9,,,290,.03,.02,,,,,.74,.32]),i.set("gain_level",[,,44,.09,,.01,3,3.3,,8,,.11,,,9.7,,,.97,.43]),i.set("battle_win",[2,,9,.28,.09,.06,,3.3,,-77,73,.24,,,,,.38,.54,.01,,-1333]),i.set("blip",[,,1008,,.01,.01,4,2,,-25,,,,.1,,.6,,.69,.02]),i.set("fight",[,,737,,.01,0,1,.3,,49,247,.03,,.5,184,,,.8,.02,.05]),i.set("ready_to_fight",[1.9,,330,.32,.36,.29,,2.7,,,46,,,,53,,.35,.91,.03]),i.set("visit_tower",[1.1,,640,.02,.03,.01,2,1.2,-4,,-225,.09,.06,,26,,.19,.52,.03,.05,725]),i.set("visit_village",[1.1,,640,.02,.03,.01,2,1.2,-4,,-225,.09,.06,,26,,.19,.52,.03,.05,725]),i.set("new_turn",[2.3,0,174,.49,1,.22,1,4,,,,,,.5,,,.08,.4,.07,,150])},kt=async()=>{var t,e=[],i=new Map;for(t of pe.data){var s,r,a,o=Number(t);isNaN(o)?([s,r]=t.split(",").map(t=>+t),e.push(s),(a={0:V,9:X,10:K,11:q,16:W,17:J,18:Q,24:Z})[8]=a[0],a[19]=a[11],i.set(e.length-1,[a[s-1],r])):e.push(o)}R.set("exampleMap",{width:pe.width,height:pe.height,data:e,St:i})},r=new Map,Mt=[],_t=[],St=t=>{var e=Array.from(r.keys());for(t.length=0,e.shift();e.length;){var i=Math.floor(D()*e.length),i=e.splice(i,1)[0];t.push(i)}},Ct=()=>{var e=(...[t,e,i,s])=>{r.set(r.size,{name:t,Ct:e,Nt:i,Ot:s})};e("Crown of Light",0,0);for(let t=0;t<3;t++)e("Bronze Sword",35,5,{[o]:1}),e("Iron Sword",55,10,{[o]:2}),e("Steel Sword",125,35,{[o]:3}),e("Sturdy Boots",30,5,{[v]:1}),e("Swift Boots",50,10,{[v]:2}),e("Magic Boots",100,50,{[v]:3}),e("Light Shield",25,5,{[l]:1}),e("Medium Shield",45,12,{[l]:2}),e("Heavy Shield",90,50,{[l]:3}),e("Omni Flower",150,100,{[o]:1,[v]:1,[l]:1});St(_t),e("Small Supply Stash",0,50),e("Big Supply Stash",0,100),St(Mt)},Nt=new Map,Ot=[],Tt=[],Et=()=>{var e=(...[t,e,i,s])=>{Ot.push([t,e,i,s])};for(let t=0;t<4;t++)e(1,w,10+15*t,75+25*t);for(let t=0;t<4;t++)e(2,w,50+15*t,100+40*t);for(let t=0;t<4;t++)e(3,w,100+25*t,100+50*t);var i=(...[t,...e])=>{Tt.push([t,e])},s=(t,e)=>U(A(D(),0,1,t,e));for(let t=0;t<4;t++)i(1,[dt,s(35,65)]),i(1,[w,s(35,65)]),i(1,[ht,s(35,65)]),i(1,[ct,s(35,65)]),i(2,[ct,s(100,200)]),i(2,[pt,s(50,100)]),i(2,[p,s(40,60)]),i(2,[ut,s(50,100)]),i(2,[at,s(75,125)]),i(2,[nt,s(75,125)]),i(3,[wt,s(30,50)]),i(3,[p,s(60,80)]),i(3,[pt,s(100,200)]),i(2,[at,s(150,200)]),i(3,[ft,s(50,100)]),i(3,[ot,s(75,125)]),i(3,[lt,s(75,125)]);i(4,[vt,300]),i(4,[p,500]),i(4,[wt,100]),Ot=ze(Ot),Tt=ze(Tt)},It=()=>{var t=(t,e,i,s)=>{e={gt:t,label:e,xt:i,[o]:5,[c]:.5,[l]:0,[u]:10,[f]:10},i=Object.assign({...e},s);i[f]=i[u],Nt.set(t,i)},e=o,i=v,s=l,r=u;t(w,"Militia",20,{}),t(at,"Footmen",21,{[e]:7,[s]:5,[r]:25}),t(ot,"Champions",22,{[e]:12,[s]:10,[r]:50}),t(ht,"Archers",28,{[i]:2,[r]:8}),t(nt,"Crossbows",29,{[e]:6,[i]:5,[r]:8}),t(lt,"Arbalists",30,{[e]:12,[i]:7}),t(dt,"Scouts",12,{[i]:3,[s]:1,[r]:20}),t(ut,"Knights",13,{[e]:8,[i]:4,[s]:2,[r]:40}),t(ft,"Cavaliers",14,{[e]:12,[i]:5,[s]:12,[r]:60}),t(vt,"Mages",36,{[i]:6,[e]:15,[r]:60}),t(ct,"Goblins",31,{[e]:4,[s]:1,[r]:6}),t(wt,"Beasts",15,{[e]:9,[s]:5,[r]:500,[i]:5}),t(p,"Skulls",37,{[e]:10,[s]:5,[r]:25,[i]:2}),t(pt,"Longnecks",23,{[e]:7,[i]:4,[s]:3,[r]:50})},x=new Map,Yt=(t,e)=>{t=t.map.Tt[e];t.event=void 0,t.id=1,t.bt="ts_0"},At=t=>Object.entries(t).map(([t,e])=>t.toUpperCase()+": "+e).join(" "),$t=()=>{let s=(e,i)=>{let s;for(let t=0;t<e.length;t++){var r=e[t];if(i===r[0]){s=[...r.slice(1)],e.splice(t,1);break}}return s},n="info",r=(x.set(V,(t,e,i)=>({label:"Battle",Et:"ready_to_fight",It:{Yt:i,units:s(Tt,e)[0]}})),x.set(X,(t,e,i)=>{let s=U(A(D(),0,1,20*e,100*e));return{label:"Chest",Et:"gold",At:{type:n,title:"Chest",M:"ts_9",text:`You found ${s} <b>GOLD</b>!`,$t:()=>{Yt(t,i),t.Dt.zt+=s}}}}),x.set(K,(t,e,i)=>{let s=Mt.shift(),r=b(s),a="";return r.Ot&&(a=At(r.Ot)),{label:"Present",Et:"item",At:{type:n,title:"Present",M:"ts_10",text:`You found: ${r.name}!  `+a,$t:()=>{Yt(t,i),t.Dt.Lt(s)}}}}),x.set(q,(t,e,i)=>({label:"Castle",Et:"battle_win",At:{...r,text:"You made it!  You brought us the <b>Crown of Light</b> and the kingdom is saved!",$t:()=>{window.location.reload()}}})),x.set(W,(t,e,i)=>({label:"Village",Et:"visit_village",store:{text:"You found a village! Need to buy or sell items?",items:[_t.shift(),_t.shift()],M:"ts_16"}})),x.set(J,(t,e,i)=>({label:"Tower",Et:"visit_tower",store:{text:"The Tower can provide you with fresh recruits.",M:"ts_17",jt:[[...s(Ot,e),10]]}})),x.set(Z,(a,t,o)=>{let h=U(A(D(),0,1,50*t,100*t));return{label:"Obelisk",Et:"exp",At:{type:n,title:"Obelisk",M:"ts_24",text:`The obelisk grants you ${h} experience!`,$t:()=>{Yt(a,o);let[t,s,e]=a.Dt.Bt(h),i="";s&&(i=Object.entries(e).map(([t,e])=>{var i=e-s[t];if(0<i)return t.toUpperCase()+`: ${e} (+${i})`}).filter(t=>t).join("<br/>"));var r=t?`You gained ${t} level(s)!<br/>`+i:"";r&&a.Ht({Et:"gain_level",At:{type:n,title:"Level Up!",M:"ts_4",text:r,$t:()=>{}}})}}}}),{type:n,title:"Time is of the Essence",M:"ts_4"});x.set(tt,(t,e,i)=>({Et:"new_turn",At:{...r,text:"The first day is done, and 12 days remain. Is there still enough time? The kingdom is counting on you."}})),x.set(st,(t,e,i)=>({Et:"new_turn",At:{...r,text:`Dawn of the next day... ${13-t.Dt.day} days remain to save the kingdom.`}})),x.set(et,(t,e,i)=>({Et:"blip",At:{...r,text:"Dawn of the FINAL day. You MUST save the kingdom by day's end or all is lost."}})),x.set(it,(t,e,i)=>({Et:"fight",At:{...r,text:"You have failed to save the kingdom. We are lost.",$t:()=>{window.location.reload()}}})),x.set(rt,(t,e,i)=>({At:{...r,text:"Hero! The kingdom is in peril!<br><br> You have 13 days to bring the <b>Crown of Light</b> to the capital city in the EAST.  The land is in chaos, and many will try to stop you, but you must persevere.<br><br>If you fail in your quest, we will be lost.  Godspeed."}}))},y=t=>document.createElement(t),k=(t,e)=>t.appendChild(e),M=(t,e,...i)=>{var s,r=y(t);r.innerHTML=e;for(s of i)k(r,s);return r},zt=e=>{let i=e.onclick,s=(e.onclick=t=>{removeEventListener("keydown",s),i&&i.call(this,t)},t=>{"Enter"!==t.key&&" "!==t.key||e.onclick(t)});addEventListener("keydown",s)},Dt=(t,e)=>{t.disabled=e,t.style.background=e?"grey":""},Lt=(t,e,f)=>{let v="div",c="p",w="span",s=e,i=y(v),r=(Object.assign(i.style,{width:"100%",height:"100%",position:"fixed",display:"flex",justifyContent:"center",alignItems:"center",top:0,left:0}),i.id="dialog",y(v)),a=(Object.assign(r.style,{width:"650px",backgroundColor:"black",padding:"20px"}),k(i,r),{show:()=>{document.body.appendChild(i)},remove:()=>{i.remove()}}),o=s.store,p=(o&&(s.text=o.text,s.M=o.M),t=>{var e=y("img"),t=Vt(qt(t));return e.src=t.toDataURL(),Object.assign(e.style,{width:"64px",height:"64px",imageRendering:"pixelated"}),e}),h=()=>{var{title:t,text:e,M:i}=s,t=M("b",t+"<br><br>"),t=(k(r,t),p(i)),i=(k(r,t),M(c,e));k(r,i)},g=()=>{var t=y(v),e=(t.style.position="relative",t.style.display="inline-block",p("ts_18"));return e.style.position="absolute",e.style.transform="translate(-12px, -38px)",k(t,e),t};switch(t){case"info":h();var n=y(c),l=(Object.assign(n.style,{textAlign:"right"}),M("button","OK"));l.onclick=()=>{a.remove(),e.$t&&e.$t()},zt(l),k(n,l),k(r,n);break;case"store":{h();let e=y(v),i=(t,s,r,a)=>{var o=y(v);o.style.height="150px",o.style.overflowY="auto";for(let i of t){let t=b(i),e=y(c);e.id="div_"+i;var h=r(t),n=f.Dt.zt>=h,h="<b>"+t.name+"</b> - "+h+" gold",h=M(w,h,g()),l=(t.Ot&&(l=At(t.Ot),(l=M(w,l)).style.marginLeft="54px",k(h,l)),M("button",s));l.style.marginRight="16px",l.onclick=()=>{a(i,t,e),d.remove(),u(),$("blip")},n&&i||Dt(l,!0),k(e,l),k(e,h),k(o,e)}k(d,o)},s=s=>{var t,r=y(v);r.style.height="154px";for(let[t,e,i]of s){var a=m(t),o=y(v),h=`Units (${e}) - `+i+" gold",n=f.Dt.zt>=i,h=M(c,h,g()),h=(k(o,h),y(v)),a=(h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="flex-start",p("ts_"+a.xt)),l=M("button","Recruit");l.style.marginTop="8px",l.onclick=()=>{f.Dt.zt>=i&&(f.Dt.zt-=i,f.Dt.unit[1]+=e,s.splice(0,1),d.remove(),u(),$("blip"))},n||Dt(l,!0),k(h,a),k(h,l),k(o,h),k(r,o)}s.length||((t=M(c,"You have already recruited these units.")).style.color="red",k(r,t)),k(d,r)},d,u=()=>{d=y(v);var t=M(v,"You have "+f.Dt.zt+" gold",g());t.style.color="yellow",k(d,t),o.items&&(k(d,M(c,"<b>BUY ITEMS</b>")),i(o.items,"Buy",t=>t.Ct,(e,t,i)=>{f.Dt.zt>=t.Ct&&(f.Dt.zt-=t.Ct,f.Dt.Lt(e),o.items=o.items.filter(t=>t!==e),i.remove())}),k(d,M(c,"<b>SELL ITEMS</b>")),i(f.Dt.items,"Sell",t=>t.Nt,(t,e,i)=>{f.Dt.zt+=e.Nt,f.Dt.removeItem(t),i.remove()})),o.jt&&s(o.jt),k(e,d)};u(),k(r,e);l=y(c),n=(Object.assign(l.style,{textAlign:"right"}),M("button","OK"));n.onclick=()=>{a.remove()},zt(n),k(l,n),k(r,l);break}case"battle":{var n=M("b","Battle<br><br>"),l=(k(r,n),y(v)),[n,l]=(k(r,l),N(650,350)),n=(k(r,n),y(v));Object.assign(n.style,{display:"flex",justifyContent:"center",marginTop:"4px"});let e=M("button","Retreat"),i=(e.onclick=()=>{t.D("retreat"),a.remove()},e.style["margin-right"]="16px",k(n,e),M("button","FIGHT!")),t=(i.onclick=()=>{s.Ft.start();var t=t=>{t.style.visibility="hidden"};t(i),t(e),$("fight")},k(n,i),k(r,n),s.Ft);t.P(l,a,r)}}return a},jt={font:"monospace",color:"#fff",size:14,align:"center",strokeColor:"black"},Bt=1,Ht=t=>{Bt=t},Ft=()=>{var t=O();S(0,0,t.width,t.height,"#333")},_=(t,e,i,s,r)=>{s=s||1,r=r||T();var a="string"==typeof t?qt(t):t;if(!a)throw new Error(`No sprite: "${t}"`);var[t,a,o,h,n]=a;r.drawImage(t,a,o,h,n,e,i,h*s,n*s)},S=(t,e,i,s,r,a,o)=>{(o=o||T())[a?"strokeStyle":"fillStyle"]=r,o[a?"strokeRect":"fillRect"](t,e,i,s)},C=(t,e,i,s,r)=>{var{font:s,size:a,color:o,align:h,strokeColor:n}={...jt,...s||{}};(r=r||T()).font=a+"px "+s,r.textAlign=h,r.textBaseline="middle",n&&(r.strokeStyle=n,r.lineWidth=4,r.strokeText(t,e,i)),r.fillStyle=o,r.fillText(t,e,i)},Pt=null,Rt={},Gt={},Ut=t=>{var[e,i,s]=N(t.width,t.height);return i.translate(s,0),i.scale(-1,1),i.drawImage(t,0,0),e},Vt=t=>{var[,,,e,i]=t,[e,i]=N(e,i);return _(t,0,0,1,i),e},Xt=(n,i,s,r,a)=>{let u=(t,e,i,s,r,a)=>{var[o,h]=N(r,a);return h.drawImage(e,i,s,r,a,0,0,r,a),n[t]=[o,0,0,r,a]},o=(t,e,i)=>{var[s,r]=N(t[3],t[4]),a=(_(t,0,0,1,r),r.getImageData(0,0,s.width,s.height)),o=a.data;for(let t=0;t<o.length;t+=4){var h,n,l,d=`${o[t]},${o[t+1]},`+o[t+2],d=i.get(d);d&&([d,h,n,l]=d.split(",").map(t=>parseInt(t)),o[t+0]=d,o[t+1]=h,o[t+2]=n,o[t+3]=l)}return r.putImageData(a,0,0),u(e,s,0,0,t[3],t[4])},h=i.width/r,t=i.height/a;for(let e=0;e<t;e++)for(let t=0;t<h;t++){var l=s+"_"+(e*h+t),d=u(l,i,t*r,e*a,r,a),f=new Map,v="255,255,255",v=(f.set(v,v+",0"),o(d,l,f)),d=Ut(Vt(v)),f=u(l+"_f",d,0,0,r,a),d=new Map;d.set("47,191,218","255,83,74,255"),d.set("77,97,156","169,59,59,255"),o(v,l+"_r",d),o(f,l+"_r_f",d)}},Kt=async t=>{O();let o={},h={};await Promise.all(t.map(([i,s,r,a],t)=>new Promise(t=>{let e=new Image;e.onload=()=>{o[i]=e,Xt(h,e,i,r,a),t()},e.src=s}))),Rt=o,Gt=h},N=(t,e)=>{var i=document.createElement("canvas"),s=(i.width=t,i.height=e,i.getContext("2d"));return s.imageSmoothingEnabled=!1,[i,s,t,e]},O=()=>{if(Pt)return Pt;{let[i,s]=N(576,576);i.id="canv",s.lineWidth=2,window.canvasDiv.appendChild(i);var t=()=>{var[t,e]=N(i.width,i.height);e.drawImage(i,0,0),i.width=window.innerWidth,i.height=window.innerHeight,s.imageSmoothingEnabled=!1,s.drawImage(t,0,0)};return e(window,"resize",t),t(),Pt=i}},T=()=>O().getContext("2d"),qt=t=>Gt[t],Wt=t=>"canv"===t.target?.id,E={Pt:0,Rt:0,scale:1,Gt:0,Ut:0,Vt:0,Xt:0,Kt:!1,qt:0,Wt:0},Jt=()=>E,Qt=()=>O().getBoundingClientRect()||{left:0,top:0,width:0,height:0},Zt=(t,e,i)=>{var[t,e]=ee(t,e),t=Math.round(t-i/E.scale*(t-E.Pt)),e=Math.round(e-i/E.scale*(e-E.Rt));E.Pt=t,E.Rt=e,E.scale=i},te=(t,e)=>{var i,s=O();s&&(i=E.scale,t=s.width/2-t,s=s.height/2-e,E.Pt=t,E.Rt=s,E.scale=1,Zt(t,s,i))},ee=(t,e)=>{var{left:i,top:s}=Qt();return[t-i,e-s]},ie=(t,e,i)=>{var[t,e]=ee(t,e),s=O();return s?(s.width,s=t-E.Pt,t=e-E.Rt,[s/E.scale,t/E.scale]):[0,0]},se=(t,e,i)=>{let[s,r]=ie(t,e,i),a=Math.floor(s/16);a%2==1&&(a=Math.floor((s-8)/16));var o,h,t=Math.floor(r/12);for([o,h]of[[a,t],...Ne([a,t])])if(Ie([o,h],[0,0,i.map.w,i.map.Jt])){var n=h%2==0?Ye([16*o,12*h,16,16]):Ye([8+16*o,12*h,16,16]);if(Ae([Math.floor(s),Math.floor(r)],n))return[o+i.map.w*h,o,h,s,r]}return s>16*i.map.w||r>16*i.map.Jt||s<0||r<0?[-1,a,t,s,r]:[t*i.map.w+a,a,t,s,r]},re=l=>{e(window,Oe,t=>{"canv"===t.target.id&&(t.preventDefault(),1===t.button||2===t.button||0===t.button)&&Wt(t)&&(E.Gt=t.clientX,E.Ut=t.clientY,E.Vt=E.Pt,E.Xt=E.Rt,E.Kt=!0)}),e(window,Ee,t=>{var e,i;E.qt=t.clientX,E.Wt=t.clientY,E.Kt?(E.Pt=E.Vt+t.clientX-E.Gt,E.Rt=E.Xt+t.clientY-E.Ut):([t,e,i]=se(t.clientX,t.clientY,l),(t=l.map.Tt[t])!==l.Qt&&(l.Qt=t))}),e(window,Te,t=>{if(E.Kt){var e=E.Vt+t.clientX-E.Gt,i=E.Xt+t.clientY-E.Ut,s=E.Gt-t.clientX,r=E.Ut-t.clientY;if(Math.abs(s)<10&&Math.abs(r)<10&&0===t.button){if(l.Zt())return;var[s,r,t]=se(t.clientX,t.clientY,l),a=me(l.map,[r,t]),{x:o,y:h}=l.Dt,{path:n,Ct:a}=be(a,l.map.w,[o,h],[r,t]);if(a<100)if(l.Dt.te===s){l.Dt.ee=!1,l.Dt.ie=0;let s=!1,r=$e(n,l),t=n[r],e=l.map.Tt[t[0]+t[1]*l.map.w],a;for(let t=1;t<n.length;t++){let[e,i]=n[t];if(l.O.p(d(50,()=>{},()=>{var t=l.map.Tt[e+i*l.map.w],t=mt(t.id);l.Dt.x=e,l.Dt.y=i,s=l.Dt.se(t),l.map.re([e,i]),$("horse_step"),s&&(t=12==(t=13-l.Dt.day)?tt:1==t?et:0==t?it:st,a=g(t)(l,0,0))})),t>=r)break}l.O.p(d(50,()=>{},()=>{let t=e.event;t?a?(a.At.$t=()=>{l.Ht(t)},l.Ht(a)):l.Ht(t):a&&l.Ht(a)}))}else l.Dt.te=s,l.Dt.path=n,l.Dt.ie=a,l.Dt.ee=!0}E.Pt=e,E.Rt=i,E.Kt=!1}}),e(window,"contextmenu",t=>{Wt(t)&&t.preventDefault()}),e(window,"wheel",e=>{if(Wt(e)){let t=E.scale;0<e.deltaY?--t:t+=1,10<t?t=10:t<1&&(t=1),Zt(e.clientX,e.clientY,t)}}),addEventListener("keydown",t=>{l.Zt()||" "===t.key&&(t=l.map.Tt[l.Dt.x+l.Dt.y*l.map.w].event)&&l.Ht(t)})},ae=(t,e)=>{var[t,i]=t,t=m(t),t=P(t,i);return[n(t,{X:e}),i]},oe=()=>{var t=Jt();return{x:t.Pt,y:t.Rt,scale:t.scale}},he=(t,e)=>{if(t.It){var i,s,r,a,o=[],h=[];for([i,s]of t.It.units){var n=m(i),n=P(n,s);o.push(n)}for([r,a]of e){var l=m(r),l=P(l,a);h.push(l)}return{units:o,ae:h,X:void 0}}},I=[o,l,v];class ne{x;y;B=!1;path=[];te;ee=!1;color="blue";oe=t(100,1/0,2);unit;zt=100;level=0;exp=0;he=[];items=[];ne=new Se(20);day=0;ie=0;X={[o]:0,[l]:0,[v]:0};constructor(){this.x=5,this.y=9,this.ne.start(),this.unit=[w,50],h(this.oe)}se(t){var e=this.ne,i=e.ms;return e.update(t),!!e.l()&&(this.day++,e.s=e.s%i,!0)}Bt(t){let e=t+this.exp,i=0,s=t=>100*(t+1)*1.25,r={...this.X},a=()=>{for(var t of I)this.X[t]+=.25<D()?1:0},o=s(this.level);for(;e>=o;){var h=this.exp-o;this.exp+=h,t-=h,e=t+this.exp,this.level++,o=s(this.level),i++,a()}return this.exp+=t,[i,r,this.X]}Lt(t){this.items.push(t);var s=b(t);for(let i=0;i<I.length;i++){let t=I[i],e=0;s.Ot&&(e+=s.Ot[t]??0),this.X[t]+=e}}removeItem(r){var t=this.items.indexOf(r);if(-1<t){this.items.splice(t,1);for(let s=0;s<I.length;s++){let t=I[s],e=0,i=b(r);i.Ot&&(e+=i.Ot[t]??0),this.X[t]-=e}}}update(t){a(this.oe,t)}ct(t,e,i){_("ts_4"+(this.B?"_f":""),t,e,i),_("ts_"+(25+this.oe.o)+"_f",t-4*i,e-6*i,i)}}class le{id;o;x;y;bt;event;le=t(500,1/0,1);px;de;constructor(){h(this.le)}update(t){a(this.le,t)}ct(s,r,a,t=!1){if(this.px=s,this.de=r,t)_("ts_39",s,r,a);else if(_(this.bt,s,r,a),this.event?.It){let[t]=this.event.It.units[0],e=m(t),i=0;this.le.o&&(i=-1*a),_("ts_"+e.xt+"_r_f",s,r+i,a)}}}class de{w;Jt;name;Tt=[];ue=[];constructor(e,t){var i=(t=>{var e=R.get(t);if(e)return e;throw new Error("No map template: "+t)})(this.name=t);this.w=i.width,this.Jt=i.height;for(let t=0;t<this.w*this.Jt;t++){var s,r=new le,a=(r.id=i.data[t],r.bt="ts_"+(r.id-1),r.o=t,r.x=t%this.w,r.y=Math.floor(t/this.w),i.St.get(t));a&&([a,s]=a,a=g(a),r.event=a(e,s,t)),this.Tt.push(r)}this.ue=new Array(this.w*this.Jt).fill(!0)}fe(t){var{x:e,y:i,scale:s}=oe(),r=+s,a=t.canvas,o=(this.w,this.Jt,a.width/2),a=a.height/2,o=o-r/s*(o-e),e=a-r/s*(a-i);t.save(),t.translate(o,e)}re([i,s]){for(let e=-3;e<=3;e++)for(let t=-3;t<=3;t++){var r=i+e,a=s+t;0<=r&&0<=a&&r<this.w&&a<this.Jt&&(this.ue[a*this.w+r]=!1)}}update(t){for(var e of this.Tt)e.update(t)}ct(e,r){this.fe(T());let t=oe().scale,a=+t,o=this.w,i=this.Jt,h=-1,n=-1;for(let s=0;s<i;s++){var l=s%2==1?8:0;for(let i=0;i<o;i++){var d=s*o+i,u=this.Tt[d],f=(16*i+l)*a,v=12*s*a;if(u.ct(f,v,a,this.ue[d]),e.ee){d=e.path.findIndex(([t,e])=>t===i&&e===s);if(-1<d){let t="white";$e(e.path,r)<d&&(t="black"),S(f+8*a-4,v+8*a-4,8,8,t),S(f+8*a-2,v+8*a-2,4,4,d===e.path.length-1?u.event?.It?"red":t:"green")}}e.x===i&&e.y===s&&(h=f,n=v)}0<h&&0<n&&e.ct(h,n,a)}T().restore()}}class ue{map;Ft;Dt=new ne;O=new j;Qt;constructor(){this.map=new de(this,"exampleMap"),this.map.re([this.Dt.x,this.Dt.y]),this.Dt.Lt(0),Jt().scale=4,te(16*this.Dt.x*4,16*this.Dt.y*4),this.Ht(g(rt)(this,0,0))}Zt(){return!!this.O.v()||!!this.Ft||!!document.getElementById("dialog")}Ht(r){if(r.Et&&$(r.Et),Jt().Kt=!1,r.It){let t=he(r,[this.Dt.unit]),s=new H(t.ae.map(t=>t),t.units.map(t=>t),this.Dt.X),e=Lt("battle",{Ft:s},this);(this.Ft=s).D=t=>{this.Ft=void 0;var e=r.It.Yt,i=("win"===t&&(Yt(this,e),this.Dt.unit[1]=s.C.k,$("army_defeated")),"retreat"===t&&(i=this.Dt.path[this.Dt.path.length-2],this.Dt.x=i[0],this.Dt.y=i[1]),this.map.Tt[e]);te(i.px,i.de),"lose"===t&&this.Ht(g(it)(this,0,0))},e.show()}r.At&&Lt(r.At.type,{title:r.At.title,text:r.At.text,M:r.At.M,$t:r.At.$t},this).show(),r.store&&Lt("store",{title:"Vendor",store:r.store,$t:()=>{}},this).show()}update(t){this.O.update(t),this.Dt.update(t),this.map.update(t),this.Ft&&this.Ft.update(t)}ct(){this.map.ct(this.Dt,this);var e=T().canvas.height-200,i={align:"left",size:16};for(let t=0;t<this.Dt.items.length;t++){var s=this.Dt.items[t],s=b(s);C(s.name,20,e+-18*(t+2),i)}C("Gold: "+this.Dt.zt,52,e,i),_("ts_18",-2,e-33,4),C("Level: "+(this.Dt.level+1),20,36+e,i);var r=["attack","defense","speed"];for(let t=0;t<r.length;t++){var a=r[t];C(a.toUpperCase()+": "+this.Dt.X[a],20,e+18*(t+3),i)}var[t,o]=ae(this.Dt.unit,this.Dt.X),h=126+e;if(C("Troop Rating: "+t,20,h-16,{align:"left"}),_("ts_4",20,h,4),C(o+"",62,64+h),C("Day: "+(this.Dt.day+1)+"/13",20,40,{align:"left"}),S(18,56,200,16,"black"),S(20,58,196*(1-this.Dt.ne.ve()),12,"grey"),t=this.Dt.ne.s,this.Dt.ne.s=t+this.Dt.ie,o=this.Dt.ne.ve(),this.Dt.ne.s=t,S(20,58,196*(1-o),12,"white"),this.Ft&&this.Ft.ct(),this.Qt&&!this.map.ue[this.Qt.o]){let t=this.Qt.event?.label??"",e="",i="white",s,r,a,o,h=oe().scale;this.map.fe(T()),t&&(this.Qt.event?.It&&(s=he(this.Qt.event,[]),t+=": "+s.units.map(t=>t.label+` (${t.k})`).join(", "),r=n(s.units[0],{}),a=e="Troop Rating: "+r,[o]=(e=t,t=a,ae(this.Dt.unit,this.Dt.X)),o<r?i="#F33":r<o&&(i="#3F3")),C(t,this.Qt.px+8*h,this.Qt.de,{color:i}),e)&&C(e,this.Qt.px+8*h,this.Qt.de-16),T().restore()}}}window.addEventListener("load",()=>{ve()});let fe=10,ve=async()=>{await ce();var t=new ue;re(t),we(t)},ce=async()=>{await gt()},we=i=>{let s=ke(),r=A(22,16,30,1,2),t=()=>{Ft(),i.ct(),requestAnimationFrame(t)};setInterval(()=>{var t=ke(),e=t-s,t=(s=t,e),e=(4<e?4:e)*r/fe;Ht(e),i.update(Math.min(t,33)),window.ce=i},22),t()},pe=(window.we=t=>{t=.3*Number(t.value)/100;De(t)},{width:36,height:20,data:"2 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 2 4 4 4 4 25,1 1 1 4 4 4 4 25,2 4 4 4 4 4 4 4 4 4 4 4 4 4 4 2 4 4 2 1 10,1 4 10,1 1 1 1 4 4 3 1 1 1 1 4 10,2 4 1 1 4 4 4 1 2 10,1 10,1 4 4 4 4 4 4 2 2 4 2 1 1 1 1 1 1 2 11,1 4 1 1 18,1 1 4 1 1 1 3 2 1 4 1 1 1,2 11,1 4 10,4 10,4 4 4 4 2 20 2 4 2 10,2 1 18,2 2 1 1 2 1 10,1 4 1 9 9 1 1,2 4 1 3 1 1 1 1 1 3 2 4 4 1 4 4 4 2 20 20 4 2 1 1 1 1 2 9,1 9 1 10,1 4 1 9 1 1 4 4 4 4 1 1 1 1 18,2 1 1 2 17,4 1 4 4 4 20 12,1 20 4 2 1 1 1 1 1 2 4 9 2 4 1 1 9 9 1 4 4 4 9,1 9 9 25,1 9 9 9 9 2 9 18,3 4 4 4 9 9 4 2 1 4 4 2 20,1 2 4 9 2 2 1 9 17,1 9 9,1 9 9 9 4 1 9 9 1 1 1 1 2 9 9 4 4 4 9,4 4 4 2 1 1 4 2 20 20 4 9 2 2 1 9 3 3 2 3 1 1 1 4 4 1 1 1 4 1 1 4 9 1 4 4 9,4 4 4 2 2 25,2 4 20 12 20 4 9,1 2 2 9 3 1 2 4 4 1 10,1 10,1 4 4 1 2 4 4 1 3 4 9 1 4 4 9,4 4 4 2 2 4 4 1 9 9 9 9 2 2 9 3 1 4 4 4 4 4 4 4 4 2 1,2 4 4 4 1,2 2 4 9 9,3 9 9 4 4 2 4 2 3 1 9 9 1 1 25,1 9,1 2 1 4 4 4 10,2 4 4 4 4 25,2 1 2 4 4 3 3 2 4 4 9 9 9 4 4 4 4 2 2 1 1 18,1 9 1 1 9 2 2 3 4 4 3 3 4 1 1 1 1 1 2 1 3 3 1 2 4 4 9 9 4 4 4 4 2 2 1 2 1 9 9 9 9 2 4 4 4 25,1 1 4 1 1 1 1 1 1 2 1 18,2 9 1 1 4 9 9 9 4 4 4 4 2 2 2 1 1 1 17,1 9 9 11,1 4 4 11,1 1 1 9 9,1 9 17,1 1 1 2 1 9,3 9 9 9 1 1 4 9 1 4 4 4 10,1 2 2 1 3 1 1 1 9 10,1 4 4 4 1 1 9 4 4 9 9 9 9 10,2 9 2 2 2 9 9,3 4 4 9 2 4 4 4 2 11,1 2 1 1 3 1 3 1 9 10,1 4 4 18,2 9 9 1 4 1 1 18,1 1 9 9 1 2 10,3 1,2 4 9 9 4 9,3 4 4 2 10,1 2 1 1 3 1 1 1 1 1 9 9 9,2 9 9 1 4 4 1 1 1 2 2 2 2 11,2 10,3 2 4 4 9 9 9 2 2 2 2 1,1 1 1 1 3 25,1 3 1 1 1 9 9 2 2 1 4 4 4 1 2 1,3 10,1 11,1 10,1 2 2 2 2 2 2 10,1 10,1 2 2 2 2 2 4 4 4 4 4 2 2 2 2 2 2 2 2 2 4 4 4 4 4 2 2 2 2 2 2 2 2 2 2 2 2 2 2".split(" ")}),Y=([t,e])=>t+","+e,ge=(t,e)=>t%e+","+Math.floor(t/e),me=(t,e)=>{var i,s=[];for(i of t.Tt){let t=mt(i.id);i.event&&!_e([i.x,i.y],e??[-1,-1])&&(t=100),s.push(t)}return s},be=(e,i,t,s)=>{var r,a=e.length/i,o=new Map,h=new Map,n=[[0,t]];for(let t=0;t<e.length;t++)o.set(ge(t,i),1/0);for(o.set(Y(t),0);0<n.length;){n.sort((t,e)=>t[0]-e[0]);var l,d,u,[f,[v,c]]=n.shift();for([l,d]of Ne([v,c]))u=l,r=d,Ie([u,r],[0,0,i,a])&&(u=f+Me([l,d],e,i))<o.get(Y([l,d]))&&(o.set(Y([l,d]),u),h.set(Y([l,d]),[v,c]),n.push([u,[l,d]]))}var w=[];if(h.get(Y(s))){let t=[],e=s;for(;e;)t.push(e),w.push(o.get(Y(e))),e=h.get(Y(e));return{path:t.reverse(),Ct:o.get(Y(s)),pe:w.reverse()}}return{path:[],Ct:1/0,pe:w}},xe=()=>({x:0,y:0,M:"",H:"",scale:1,offsetX:0,offsetY:0,filter:"",B:!1}),ye=(t,e)=>{(e=e??T()).save(),t.filter&&(e.filter=t.filter),_(t.M+(t.H?"_"+t.H:"")+(t.B?"_f":""),t.x+t.offsetX,t.y+t.offsetY,t.scale,e),e.restore()},ke=()=>window.performance.now(),A=(t,e,i,s,r)=>s+(t-e)*(r-s)/(i-e),Me=([t,e],i,s)=>t<0||s<=t||e<0||s<=e?-1/0:i[t+e*s],_e=(t,e)=>t?.[0]===e?.[0]&&t?.[1]===e?.[1];class Se{ms;s=-999;constructor(t){this.ms=t}start(){this.s=0}stop(){this.s=-1}ve(){return Math.max(0,Math.min(1,this.s/this.ms))}complete(){this.s=-999}l(){return this.s>=this.ms}update(t){0<=this.s&&(this.s+=t)}}let Ce={},$=t=>{t=bt(t);Le(t)},Ne=([t,e])=>e%2==0?[[t-1,e],[t+1,e],[t-1,e-1],[t,e-1],[t-1,e+1],[t,e+1]]:[[t-1,e],[t+1,e],[t,e-1],[t+1,e-1],[t,e+1],[t+1,e+1]],Oe="mousedown",Te="mouseup",Ee="mousemove",e=(t,e,i)=>{t.addEventListener(e,i)},Ie=(t,e)=>t[0]>=e[0]&&t[0]<=e[0]+e[2]&&t[1]>=e[1]&&t[1]<=e[1]+e[3],Ye=t=>{var[t,e,i,s]=t,r=i/2,a=s/4;return[[t+r,e],[t+i,e+a],[t+i,e+3*a],[t+r,e+s],[t,e+3*a],[t,e+a]]},Ae=(e,i)=>{let s=!1,r=0;for(let t=0;t<i.length;t++){(r=t+1)==i.length&&(r=0);var a=i[t],o=i[r];(a[1]>=e[1]&&o[1]<e[1]||a[1]<e[1]&&o[1]>=e[1])&&e[0]<(o[0]-a[0])*(e[1]-a[1])/(o[1]-a[1])+a[0]&&(s=!s)}return s},$e=(t,e)=>{let i=0,s=e.Dt.ne.s;for(i=1;i<t.length;i++){var[r,a]=t[i],r=e.map.Tt[r+a*e.map.w],a=mt(r.id);if((s+=a)>=e.Dt.ne.ms)break}return i>=t.length?i-1:i},ze=t=>t.map(t=>({ge:t,s:Math.random()})).sort((t,e)=>t.s-e.s).map(({ge:t})=>t),De=(e(window,"keydown",t=>{Ce[t.key]=!0}),e(window,"keyup",t=>{Ce[t.key]=!1}),t=>{Be=t}),Le=t=>{je(...t)},je=(...t)=>Fe(Pe(...t)),Be=.3,z=44100,He=new(window.AudioContext||webkitAudioContext),Fe=(...t)=>{let i=He.createBuffer(t.length,t[0].length,z),e=He.createBufferSource();return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(He.destination),e.start(),e},D=Math.random,Pe=(t=1,e=.05,i=220,s=0,r=0,a=.1,o=0,h=1,n=0,l=0,d=0,u=0,f=0,v=0,c=0,w=0,p=0,g=1,m=0,b=0)=>{let x=2*Math.PI,y=n*=500*x/z/z,k=i*=(1+2*e*D()-e)*x/z,M=[],_=0,S=0,C=0,N=1,O=0,T=0,E=0,I,Y;for(s=s*z+9,m*=z,r*=z,a*=z,p*=z,l*=500*x/z**3,c*=x/z,d*=x/z,u*=z,f=f*z|0,Y=s+m+r+a+p|0;C<Y;M[C++]=E)++T%(100*w|0)||(E=o?1<o?2<o?3<o?Math.sin((_%x)**3):Math.max(Math.min(Math.tan(_),1),-1):1-(2*_/x%2+2)%2:1-4*Math.abs(Math.round(_/x)-_/x):Math.sin(_),E=(f?1-b+b*Math.sin(x*C/f):1)*(0<E?1:-1)*Math.abs(E)**h*t*Be*(C<s?C/s:C<s+m?1-(C-s)/m*(1-g):C<s+m+r?g:C<Y-p?(Y-C-p)/a*g:0),E=p?E/2+(p>C?0:(C<Y-p?1:(Y-C)/p)*M[C-p|0]/2):E),I=(i+=n+=l)*Math.cos(c*S++),_+=I-I*v*(1-1e9*(Math.sin(C)+1)%2),N&&++N>u&&(i+=d,k+=d,N=0),!f||++O%f||(i=k,n=y,N=N||1);return M};